!function(){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<r;){var o=t[i];if(e.call(n,o,i,t))return o;i++}}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),n=r.length>>>0;if(0===n)return!1;for(var i,o,a=0|t,u=Math.max(a>=0?a:n-Math.abs(a),0);u<n;){if((i=r[u])===(o=e)||"number"==typeof i&&"number"==typeof o&&isNaN(i)&&isNaN(o))return!0;u++}return!1}}),Array.prototype.some||(Array.prototype.some=function(e){if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof e)throw new TypeError;for(var t=Object(this),r=t.length>>>0,n=arguments.length>=2?arguments[1]:void 0,i=0;i<r;i++)if(i in t&&e.call(n,t[i],i,t))return!0;return!1}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<r;){var o=t[i];if(e.call(n,o,i,t))return i;i++}return-1}}),Array.prototype.reduce||Object.defineProperty(Array.prototype,"reduce",{value:function(e){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var t,r=Object(this),n=r.length>>>0,i=0;if(arguments.length>=2)t=arguments[1];else{for(;i<n&&!(i in r);)i++;if(i>=n)throw new TypeError("Reduce of empty array with no initial value");t=r[i++]}for(;i<n;)i in r&&(t=e(t,r[i],i,r)),i++;return t}}),Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(r,n){return Array.isArray(n)?r.push.apply(r,e.call(n,t-1)):r.push(n),r},[]):Array.prototype.slice.call(this)},writable:!0}),Promise.allSettled||(Promise.allSettled=function(e){var t=e.map(function(e){return Promise.resolve(e).then(function(e){return{status:"fulfilled",value:e}},function(e){return{status:"rejected",reason:e}})});return Promise.all(t)});var e="pre-cache:",t="runtime-cache";var r={fetch:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).fetchOptions;return fetch(e,t).then(function(e){if(200!==e.status){var t=new Error("Fetch Failed");throw t.response=e,t}return e})}},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},u=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)};function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];return e.reduce(function(e,t){return e.then(t)},Promise.resolve(t))}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];e.map(function(e){return e.cacheDidUpdate(t)})}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];e.map(function(e){return e.afterUpdateCache(t)})}var f=function(){function e(){n(this,e)}return i(e,[{key:"beforeCache",value:function(e,t){return t}},{key:"beforeResponse",value:function(e,t){return t}},{key:"cacheDidUpdate",value:function(e){}},{key:"afterUpdateCache",value:function(e){}}]),e}();function p(e){var t=e.cacheName,r=e.request,n=e.matchOptions,i=void 0===n?{}:n,o=e.plugins,a=void 0===o?[]:o,u=t?caches.open(t):Promise.resolve(caches);return u.then(function(e){var t,n=(t=r.url,i.ignoreSearch?t.split("?")[0]:t);return e.match(n).then(function(e){if(e)return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.request,n=t.cachedResponse;return s(e.map(function(e){return function(t){return e.beforeResponse(r,t)}}),n)}(a,{request:r,cachedResponse:e});throw new Error("cache match failed："+n)})})}var v={put:function(e){var t=e.cacheName,r=e.request,n=e.response,i=e.event,o=e.plugins,a=void 0===o?[]:o,u=e.cacheOptions,c=void 0===u?{}:u;!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.request,n=t.response;s(e.map(function(e){return function(t){return e.beforeCache(r,t)}}),n)}(a,{request:r,response:n});var f=c.ignoreSearch?r.url.split("?")[0]:r.url,v=function(e){return[l,h].map(function(r){return r(a,{cacheName:t,event:i,newResponse:n,oldResponse:e})})},d={ignoreSearch:c.ignoreSearch};return caches.open(t).then(function(e){return p({cacheName:t,request:r,matchOptions:d}).then(v).catch(function(){p({request:r,matchOptions:d}).then(v).catch(function(e){console.log(t,"putWrapper getCache ",e)})}),e.put(f,n.clone())})},match:p};function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.fetchOptions,i=e.cacheName,o=void 0===i?t:i,a=e.matchOptions,u=e.cacheOptions,c=arguments[1];return function(e){var t=e.request,i=e.runtimeCacheRequest,s=r.fetch(t,{fetchOptions:n}).then(function(r){v.put({cacheName:o,request:i||t,response:r,event:e,cacheOptions:u,plugins:c})});return function(e){var t=e.request,r=e.cacheName,n=e.matchOptions,i=e.plugins;return v.match({request:t,cacheName:r,matchOptions:n,plugins:i}).catch(function(){return v.match({request:t,matchOptions:n,plugins:i})}).catch(function(e){console.log("staleWhileRevalidate getCache err: ",e)})}({request:i||t,cacheName:o,matchOptions:a,plugins:c}).catch(function(){return s})}}function m(e){for(var t=location.search.substring(1).split("&"),r=0;r<t.length;r++){var n=t[r].split("=");if(n[0]===e)return decodeURIComponent?decodeURIComponent(n[1]):n[1]}return null}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments[1];return"string"==typeof e&&"string"==typeof t&&e.toLowerCase().includes(t.toLowerCase())}function g(e){return new Promise(function(t){return setTimeout(t,e)})}var w=2e3;function b(e){if(!e)return Promise.resolve(null);var t=Date.now();return function e(t,r){return Promise.resolve(t).then(function(n){return n().then(function(n){return n||g(r).then(function(){return e(t,r)})})})}(function(){return r=e,self.clients.matchAll({type:"window"}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Date.now()-t>w?Promise.reject(Error("find resulting window timeout")):e.find(function(e){return r===e.id})});var r},100).catch(function(){return null})}function R(e,t){if(!e||!t)return!1;var r=function(e){return e?e.split("&").map(function(e){var t=e.split("=");return{key:t[0],value:t[1]}}):[]},n=e.split("?")[0],i=e.split("?")[1],o=t.split("?")[0],a=t.split("?")[1];if(n!==o)return!1;var u=r(i),c=r(a);return u.every(function(e){return c.some(function(t){return t.key=e.key&&t.value===e.value})})}function x(e){return e.reduce(function(e,t){var r,n=t.url||t;return n&&"string"==typeof n&&(r=n,!e.some(function(e){return(e.url||e)===r}))&&e.push(t),e},[])}function C(e){var t=e.newResponse.headers.get("content-type");return t&&t.toLowerCase().includes("application/json")?e.newResponse.clone().json().then(function(t){return{cacheName:e.cacheName,updatedURL:e.event.request.url,response:t}}):Promise.resolve({cacheName:e.cacheName,updatedURL:e.event.request.url})}var O=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.headersToCheck,i=void 0===r?["content-length","etag","last-modified"]:r,o=e.generatePayload,u=void 0===o?C:o;n(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return c._headersToCheck=i,c._generatePayload=u,c}return o(t,f),i(t,[{key:"cacheDidUpdate",value:function(e){this._notifyIfUpdated(e)}},{key:"afterUpdateCache",value:function(e){this._postMessage2Window(e,{type:"UPDATE_CACHE"})}},{key:"_notifyIfUpdated",value:function(e){var t=this;if(e.oldResponse){var r,n,i,o=e.event.resultingClientId;if(r=e.oldResponse,n=e.newResponse,(i=this._headersToCheck).some(function(e){return r.headers.has(e)&&n.headers.has(e)})&&!i.every(function(e){var t=r.headers.has(e)===n.headers.has(e),i=r.headers.get(e)===n.headers.get(e);return t&&i}))"navigate"===(e.event.request?e.event.request.mode:"")?b(o).then(function(r){!r||self.isSafari?g(3500).then(function(){return t._postMessage2Window(e)}):t._postMessage2Window(e)}):this._postMessage2Window(e)}}},{key:"_postMessage2Window",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.type,n=void 0===r?"CACHE_UPDATED":r,i=t.meta,o=void 0===i?"mihoyo-sw-broadcast-update":i;this._generatePayload(e).then(function(e){var t={type:n,meta:o,payload:e};console.log("sw postMessage2Window"),self.clients.matchAll({type:"window"}).then(function(e){console.log("sw matchWindow windows.length:",e.length);for(var r=0;r<e.length;r++)e[r].postMessage(t)})}).catch(function(e){console.log("BroadCastUpdatePlugin generatePayload err: ",e)})}}]),t}(),E=function(){function e(t){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).cacheName;n(this,e),this.router=t,this.cacheName=r}return i(e,[{key:"cacheResources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];return console.log("cacheName",t,e),Promise.all(e.map(function(e){return caches.open(t).then(function(t){var r=e.response,n=e.url;return"string"==typeof e&&(n=e),t.match(n).then(function(e){if(!e)return r?t.put(n,r):t.add(n).catch(function(){})}),e})}))}},{key:"clearExpireCache",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.cacheName;if(e&&e.length){var r=e.map(function(e){return e.url||e});caches.open(t).then(function(e){e.keys().then(function(t){t.forEach(function(t){r.some(function(e){return R(e,t.url)})||e.delete(t)})})})}}},{key:"precache",value:function(e){return this.cacheResources(e,this.cacheName)}},{key:"addRoute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=d({matchOptions:arguments[1],fetchOptions:{credentials:"same-origin",mode:"cors"}},[new O]);this.router.registerRoute("precacheRoute",function(t){return e.some(function(e){return e.url===t.url})},function(r){return!!e.find(function(e){return e.url===r.request.url})&&t(r)}),this.clearExpireCache(e)}},{key:"precacheAndRoute",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1];return this.precache(t).then(function(){return e.addRoute(t,r)})}}],[{key:"initEventListener",value:function(){self.addEventListener("activate",function(){console.log("####activate####"),self.clients.claim()})}}]),e}();function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cacheName,n=e.fetchOptions,i=e.matchOptions,o=arguments[1];return function(e){var a=e.request;return v.match({request:a,cacheName:t,matchOptions:i,plugins:o}).catch(function(){return r.fetch(a,{fetchOptions:n})}).catch(function(e){console.log("cacheFirst getCache err: ",e)})}}function P(e,t,r){return e.arrayBuffer().then(function(t){var n=function(e,t,r){var n=e.byteLength;if(r&&r>n||t&&t<0)throw new Error("range-not-satisfiable:"+{size:n,end:r,start:t});var i=void 0,o=void 0;return void 0!==t&&void 0!==r?(i=t,o=r+1):void 0!==t&&void 0===r?(i=t,o=n):void 0!==r&&void 0===t&&(i=n-r,o=n),{start:i,end:o}}(t,r.start,r.end),i=t.slice(n.start,n.end),o=i.byteLength,a=new Response(i,{status:206,statusText:"Partial Content",headers:e.headers});return a.headers.set("status","206"),a.headers.set("content-length",String(o)),a.headers.set("content-range","bytes "+n.start+"-"+(n.end-1)+"/"+t.byteLength),a})}function k(e,t){if(206===t.status)return t;var r=e.headers.get("range");if(!r)throw new Error("no range header");return P(t,0,function(e){var t=e.trim().toLowerCase();if(!t.startsWith("bytes="))throw new Error("unit-must-be-bytes "+t);if(t.includes(","))throw new Error("single-range-only:"+t);var r=/(\d*)-(\d*)/.exec(t);if(!r||!r[1]&&!r[2])throw new Error("invalid-range-values:"+t);return{start:""===r[1]?void 0:Number(r[1]),end:""===r[2]?void 0:Number(r[2])}}(r))}var N=function(e){function t(){return n(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,f),i(t,[{key:"beforeResponse",value:function(e,t){try{return t&&e.headers.get("range")&&self.isSafari?k(e,t):t}catch(e){return Promise.reject(e)}}}]),t}(),j=function(t){function r(e){n(this,r);var t=a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.pages=[],t.resources=[],t.fetchOptions={credentials:"same-origin",mode:"cors"},E.initEventListener(),t}return o(r,E),i(r,[{key:"precache",value:function(t){var r=this;return Promise.all(t.map(function(t){var n=t.assets,i=void 0===n?[]:n,o=t.url;return r.cacheResources(i.map(function(e){return{url:e}}),e+o)}))}},{key:"addRoute",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1];this.pages=t,t&&0===t.length&&(this.resources=[]);for(var n=0;n<t.length;n++){var i=t[n].assets;this.resources=this.resources.concat(i)}var o=A({matchOptions:r,fetchOptions:this.fetchOptions},[new N]);this.registerRoute("pagePrecacheRoute",function(t){return e.resources.some(function(e){return e===t.url})},function(t){return!!e.resources.find(function(e){return e===t.request.url})&&o(t)})}},{key:"precacheAndRoute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.addRoute(e,t),this.precache(e)}},{key:"cacheAndRouteRuntimeCache",value:function(e,t){var r=this,n=e.runtimeCache,i=e.routerNameSpace,o=void 0===i?"pageRuntime":i,a=e.cacheNameSpace;console.log("runtimeCache: ",n),this.cacheRuntimeCache({runtimeCache:n,routerNameSpace:o,cacheNameSpace:a}).then(function(e){e.forEach(function(e){r.routeRuntimeCache(e,t)})})}},{key:"cacheRuntimeCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.runtimeCache,r=e.routerNameSpace,n=void 0===r?"":r,i=e.cacheNameSpace,o=i||"page-runtime-cacheFirst",a=i||"page-runtime-staleWhileRevalidate",c=[this.cacheResources(t.cacheFirst,o),this.cacheResources(t.staleWhileRevalidate,a)];return o===a?this.clearExpireCache(t.cacheFirst.concat(t.staleWhileRevalidate),o):(this.clearExpireCache(t.cacheFirst,o),this.clearExpireCache(t.staleWhileRevalidate,a)),Promise.all(c).then(function(e){var t=u(e,2),r=t[0],i=t[1];return[{cacheName:o,runtimeCache:r,strategy:A,routerName:n+"CacheFirst"},{cacheName:a,runtimeCache:i,strategy:d,routerName:n+"StaleWhileRevalidate",plugins:[new O]}]})}},{key:"routeRuntimeCache",value:function(e,t){var r=e.cacheName,n=e.routerName,i=e.strategy,o=e.runtimeCache,a=void 0===o?[]:o,u=e.plugins;if(0!==a.length){var c,s=i({matchOptions:t,cacheName:r,fetchOptions:this.fetchOptions},u);this.registerRoute(n,(c=a,function(e){return c.some(function(t){return R(t.url,e.url)})}),function(e,t){return function(r){var n=t.find(function(e){return R(e.url,r.request.url)});return!!n&&(r.runtimeCacheRequest=new Request(n.url,r.request),e(r))}}(s,a))}}},{key:"registerRoute",value:function(e,t,r){this.router.registerRoute(e,t,r)}},{key:"clearExpirePageCache",value:function(){var t=this.pages.map(function(t){return e+t.url});return caches.keys().then(function(r){return Promise.all(r.map(function(r){return!t.includes(r)&&r.startsWith(e)?caches.delete(r):Promise.resolve("no caches to delete")}))})}}]),r}();function q(e,t){switch(Object.prototype.toString.call(e)){default:return!1;case"[object String]":return t.url===e;case"[object RegExp]":return t.url.match(e);case"[object Function]":return e(t)}}function S(e,t){try{var r=t(e);if(r instanceof Promise){var n=r.then(function(e){if(!(e instanceof Response))throw Error("返回结果异常");return e}).catch(function(t){return t.response||fetch(e.request.clone())}).catch(function(){});return void e.respondWith(n)}r instanceof Response&&e.respondWith(r)}catch(e){console.log(e)}}var _=function(){function e(t){n(this,e),this.useProxy=!0,this.routes=[],this.initEventListener(t)}return i(e,[{key:"initEventListener",value:function(e){var t=this;try{self.addEventListener("install",function(t){console.log("####install####"),t.waitUntil(e&&e(t))}),self.addEventListener("fetch",function(e){if(console.log("fetch routes: ",t.routes.map(function(e){return e.ruleName}).toString()),t.useProxy)for(var r=0;r<t.routes.length;r++){var n=t.routes[r];if(e.request.url.startsWith("https:")&&/get/i.test(e.request.method)&&q(n.rule,e.request)){S(e,n.handler);break}}})}catch(e){console.log("initEventListenerError",e)}}},{key:"registerRoute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"route-cache",t=arguments[1],r=arguments[2];this.unRegisterRoute(e),this.routes.push({ruleName:e,rule:t,handler:r})}},{key:"unRegisterRoute",value:function(e){var t=this.routes.findIndex(function(t){return t.ruleName===e});-1!==t&&this.routes.splice(t,1)}},{key:"setProxy",value:function(e){this.useProxy=e}}]),e}(),W={"zh-cn":/^zh-cn/i,"zh-tw":/^zh-tw/i,"en-us":/^en\b/i,"fr-fr":/^fr\b/i,"de-de":/^de\b/i,"es-es":/^es\b/i,"pt-pt":/^pt\b/i,"ru-ru":/^ru\b/i,"ja-jp":/^ja\b/i,"ko-kr":/^ko\b/i,"th-th":/^th\b/i,"vi-vn":/^vi\b/i,"id-id":/^id\b/i};var F=m("platform"),T=m("network")||"WiFi";function U(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.enable,n=t.load_limit,i=void 0===n?3:n,o=t.pages,a=void 0===o?[]:o,u=(new Date).getTime(),c=a.map(function(e){if(e.assets=e.res_list.map(function(e){return encodeURI(e)}),e.runtimeCache=[],e.runtime_cache)try{e.runtimeCache=JSON.parse(e.runtime_cache)}catch(e){console.log("parseRuntimeCacheString",e)}return e}).filter(function(e){return function(e){return y(e.platform,F)}(e)&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.end_time,r=void 0===t?"":t,n=e.start_time,i=void 0===n?"":n,o=new Date(r.replace(/-/g,"/")).getTime(),a=new Date(i.replace(/-/g,"/")).getTime();return u<o&&u>=a}(e)}),s=c.filter(function(e){return function(e){return y(e.network,T)}(e)});return r?caches.keys().then(function(t){return{precachePages:s.filter(function(r){return!!t.includes(e+r.url)||--i>=0}),routePages:c,enable:r}}):{precachePages:[],routePages:c,enable:r}}function L(e){return Promise.allSettled(e).then(function(e){return e.filter(function(e){return"fulfilled"!==e.status&&console.log("reason",e.reason),"fulfilled"===e.status}).map(function(e){return e.value})})}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.split(".").reduce(function(e,t){var r,n,i,o=(n=(r=t).indexOf("["),i=r.indexOf("]"),0===n&&i>-1?r.substring(n+1,i):r);return Array.isArray(e)&&isNaN(Number(t))?e.map(function(e){return e?e[o]:e}).flat():e?e[o]:e},e)}function I(e,t){if(Array.isArray(e.query)){var r=!0,n=e.url.includes("?")?e.url+"&":e.url+"?",i=e.query.reduce(function(e,n,i){var o=function(e){if("string"==typeof e)return{queryKey:e,queryValue:t[e]};var r=D(t,e.value);return{queryKey:e.key,queryValue:r}}(n),a=o.queryKey,u=o.queryValue;return u||(r=!1),e+(i?"&":"")+a+"="+u},n);return r?i:""}return e.url}function z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(e,t){return e.map(function(e){return function(e,t,r){if(!t)return Array.isArray(e)?e:[e];var n=new RegExp(t,r),i=function(e,t){return e.match(t)||[]},o=function(e){return/\.(png|je?pg|gif|svg)/.test(e.split("?")[0])};return Array.isArray(e)?e.map(function(e){return i(e,n).filter(o)}).flat():i(e,n).filter(o)}(D(t,e.key||e),e.regExp,e.flags).map(function(e){return{href:e,handler:"cacheFirst",useCache:!0}})}).flat()},n=function(e,r){return z(e,Object.assign({},t,{$:r}))},i=e.map(function(e){e.href=I(e,t);var i=e.href,o=e.handler,a=void 0===o?"cacheFirst":o,u=e.useCache,c={href:i,handler:a,useCache:void 0===u||u},s=Promise.resolve([]);if(Array.isArray(e.assets)||Array.isArray(e.next)){if(!e.href||!e.href.startsWith("https"))return Promise.resolve(c);s=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).fetchOptions;return fetch(e,t).then(function(e){if(200!==e.status)throw Error("status:"+e.status);return e})}(e.href).then(function(e){return c.response=e.clone(),e.json()})}if(Array.isArray(e.assets)&&Array.isArray(e.next))return s.then(function(t){var i=r(e.assets,t);i.unshift(c);var o=i.map(function(e){return Promise.resolve(e)});return o.push(n(e.next,t)),L(o)});if(Array.isArray(e.assets))return s.then(function(t){var n=r(e.assets,t);return n.unshift(c),n});if(Array.isArray(e.next)){var h=s.then(function(t){return n(e.next,t)});return L([Promise.resolve(c),h])}return Promise.resolve(c)});return L(i)}function M(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).reduce(function(e,t){if(t.query&&t.query.length)e.runtimeCache.push(t);else{var r=e.staticCache[t.handler];r&&r.push({url:t.url})}return e},{staticCache:{cacheFirst:[],staleWhileRevalidate:[]},runtimeCache:[]})}function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];return e.map(function(e){return function(e,t){var r={cacheFirst:[],staleWhileRevalidate:[]};return e.length?(console.log("parseRuntimeCacheConfig runtimeCaches:",e,t),z(e,t).then(function(e){return e.flat(1/0).filter(function(e){return e.useCache&&e.href}).reduce(function(e,t){var r={url:t.href,response:t.response};return e[t.handler]=x(e[t.handler].concat(r).flat()),e},r)})):Promise.resolve(r)}(e,t)}).reduce(function(e,t){return e.then(function(e){var r=e.cacheFirst,n=e.staleWhileRevalidate;return t.then(function(e){return{cacheFirst:r.concat(e.cacheFirst),staleWhileRevalidate:n.concat(e.staleWhileRevalidate)}})})}).then(function(e){var t=e.cacheFirst,r=e.staleWhileRevalidate;return{cacheFirst:x(t),staleWhileRevalidate:x(r)}})}function $(){return"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}}var B,K,H,J,G=(B=Date.now(),K=0,H={now:function(){var e=Date.now()-B;return e<K&&(e=K),K=e,e},timeOrigin:B},(J=$().performance)&&J.now?(void 0===J.timeOrigin&&(J.timeOrigin=J.timing&&J.timing.navigationStart||B),J):H);function X(){return(G.timeOrigin+G.now())/1e3}var Q=new(function(){function e(){n(this,e)}return i(e,[{key:"init",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.dsn=t.dsn,this.createApi(),this.globalObject=$(),this.proxyFetch(),this.initEventListener(),this.isSea="webstatic-sea.mihoyo.com"===(e=location.host)||/hoyoverse/i.test(e),this.isTest=function(e){return/-test/i.test(e)}(location.host)}},{key:"initEventListener",value:function(){var e=this;self.addEventListener("error",function(t){e.captureException(t.error)})}},{key:"proxyFetch",value:function(){var e=this;this.globalObject.originalFetch=this.globalObject.fetch;var t=function(t,r){return e.globalObject.originalFetch(t,r).then(function(e){if(e.status>=300||e.status<200)throw new TypeError("proxyFetch:Failed to fetch，status："+e.status);return e}).catch(function(n){var i=new TypeError("proxyFetch:"+n.message);throw e.captureException(i,{fetchInfo:{url:t.url||t,method:r?r.method:"GET"}}),n})};this.globalObject.fetch=t}},{key:"createApi",value:function(){var e=this.dsn.split("https://")[1].split("@sentry.mihoyo.com/"),t=u(e,2),r=t[0],n=t[1],i=this.isSea?"https://sentry-sea.hoyoverse.com":"https://sentry.mihoyo.com";this.api=i+"/api/"+n+"/store/?sentry_key="+r+"&sentry_version=7"}},{key:"postException",value:function(e){if(!this.isTest)return this.globalObject.originalFetch(this.api,{method:"post",headers:{accept:"*/*","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","content-type":"text/plain;charset=UTF-8","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site"},body:JSON.stringify(e)}).catch(function(){})}},{key:"createData",value:function(e,t){var r=t.fetchInfo,n=this.globalObject,i=n.navigator,o=n.location,a=i?i.userAgent:"unknown ua",c=o?o.href:"unknown url",s=function(){var e=$(),t=e.crypto||e.msCrypto;if(void 0!==t&&t.getRandomValues){var r=new Uint16Array(8);t.getRandomValues(r),r[3]=4095&r[3]|16384,r[4]=16383&r[4]|32768;var n=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return n(r[0])+n(r[1])+n(r[2])+n(r[3])+n(r[4])+n(r[5])+n(r[6])+n(r[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}(),h=[];if(r){var l=r.method,f=r.url,p=(void 0===f?"":f).split("?"),v=u(p,1)[0],d=Object.prototype.toString.call(v);"[object String]"!==d&&(v="unknown request url;url type:"+d),h.push({timestamp:X(),category:"fetch",data:{method:(l||"get").toLocaleUpperCase(),url:v},level:"error",type:"http"})}return{event_id:s,request:{headers:{"User-Agent":a},url:c},exception:{values:[{type:e.name,value:e.message,mechanism:{handled:!0,type:"generic"}}]},breadcrumbs:h,level:"error",platform:"javascript",timeStamp:X()}}},{key:"captureException",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).fetchInfo,r=this.createData(e,{fetchInfo:t});this.postException(r)}}]),e}());Q.init({dsn:"https://690b1e8e41244bb1aafa7bf1b7ef559e@sentry.mihoyo.com/23"});try{var Y=self.navigator?self.navigator.userAgent:"Safari";self.isSafari=(/Safari/i.test(Y)||!!Y.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/))&&!/Chrome/i.test(Y),self.isIos=/ios/i.test(m("platform")),self.env="prod";var Z=m("gameBiz"),ee=function(e){return Object.keys(W).find(function(t){return W[t].test(e)})||"zh-cn"}(Z.endsWith("_cn")?"zh-cn":m("lang")),te=1e3*Math.floor((new Date).getTime()/1e4)*10,re=location.origin+"/"+(/beta/.test(self.env)?"beta/":"")+"admin/swpreload/"+Z+"/"+ee+".json?timestamp="+te,ne=new _,ie=new j(ne);ne.registerRoute("htmlRoute",function(e){var t=e.url.split("?")[0].split("#")[0];return/.*\.html$/.test(t)&&!/\/sw.html$/.test(t)},d({cacheName:t,matchOptions:{ignoreSearch:!0},cacheOptions:{ignoreSearch:!0}})),ne.registerRoute("jsonRoute",/https:\/\/webstatic(-sea)?(-test)?.(mihoyo|hoyoverse).com\/.*\.json(\?.*)?$/,d({cacheName:t})),ne.registerRoute("precacheRoute",/https:\/\/webstatic(-sea)?(-test)?.(mihoyo|hoyoverse).com\/.*\.(js|css|png|jpe?g|gif|mp3)(\?.*)?$/,A({fetchOptions:{mode:"cors",credentials:"same-origin"}}));var oe=[],ae=fetch(re).then(function(e){return e.json()}).then(U).then(function(e){var t=e.precachePages,r=e.routePages,n=e.enable;ne.setProxy(n),ne.unRegisterRoute("precacheRoute"),oe=t.map(function(e){return M(e.runtimeCache).runtimeCache});var i=t.reduce(function(e,t){var r,n,i=M(t.runtimeCache).staticCache;return(r=e.cacheFirst).push.apply(r,c(i.cacheFirst)),(n=e.staleWhileRevalidate).push.apply(n,c(i.staleWhileRevalidate)),e},{cacheFirst:[],staleWhileRevalidate:[]});return ie.cacheAndRouteRuntimeCache({runtimeCache:i,routerNameSpace:"pageRuntimeStatic",cacheNameSpace:"page-runtime-static"}),t&&t.length?ie.precacheAndRoute(t):ie.addRoute(r)}).catch(function(e){throw ne.unRegisterRoute("precacheRoute"),ie.addRoute([]),e}).then(function(){return ie.clearExpirePageCache()}).then(self.skipWaiting).catch(function(e){return Q.captureException(e)});self.addEventListener("message",function(e){var t=e.data||{},r=t.meta,n=t.data;n.game_biz=n.game_biz||n.gameBiz,"useRuntimeCache"===r&&ae.then(function(){V(oe,n).then(function(e){return ie.cacheAndRouteRuntimeCache({runtimeCache:e})})})})}catch(e){throw"ios"===m("platform")&&Q.captureException(e),e}}();
